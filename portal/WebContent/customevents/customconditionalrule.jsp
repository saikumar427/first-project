<%
String eventid=request.getParameter("eid");
System.out.println("customconditionalrule.jsp eventid: "+eventid);
if("153534833".equals(eventid)){
%>
var custom_conditional_rules=[

{"id":138392, 
"r":{"t":"xe","d":[138491,138492,141383],"m":"To buy one day pre conference package, please choose only one of the classes on 22 & 23rd."
}
},
{"id":137511, 
"r":{"t":"o",
"d":[{"t":"oe","d":[138484,138485,138486,138487]},
{"t":"ae","d":[138491,138492]},
],"m":"To buy pre-Conference package, please choose one of the two day classes or both one day classes on 22 & 23rd."
}
},
{"id":137512, 
"r":{"t":"o",
"d":[{"t":"oe","d":[138484,138485,138486,138487]},
{"t":"ae","d":[138491,138492]},
],"m":"To buy pre-Conference package, please choose one of the two day classes or both one day classes on 22 & 23rd."
}
},
{"id":137513, 
"r":{"t":"o",
"d":[
{"t":"oe","d":[138498]},
{"t":"a","d":[{"t":"oe","d":[138493,138494,138495,138496,138497]},
			  {"t":"oe","d":[138499,138500,138501,138502,138503]}
			 ]
},
{"t":"a","d":[{"t":"oe","d":[138505,138506,138507]},
			  {"t":"oe","d":[138508,138509,138510]},
			  {"t":"oe","d":[138511,138512,138513]},
			  {"t":"oe","d":[138514,138515,138516]}
			 ]
},
{"t":"a","d":[{"t":"oe","d":[138493,138494,138495,138496,138497]},
			  {"t":"oe","d":[138511,138512,138513]},
			  {"t":"oe","d":[138514,138515,138516]}
			 ]
},
{"t":"a","d":[{"t":"oe","d":[138499,138500,138501,138502,138503]},
			  {"t":"oe","d":[138505,138506,138507]},
			  {"t":"oe","d":[138508,138509,138510]}
			 ]
}
],"m":"To buy Main-Conference package, please choose two day class (24-25) or a combination of the one day classes on the 24 & 25 and half-day classes on the morning and afternoon of the 24 - 25."
}
},

{"id":137514, 
"r":{"t":"o",
"d":[
{"t":"oe","d":[138498]},
{"t":"a","d":[{"t":"oe","d":[138493,138494,138495,138496,138497]},
			  {"t":"oe","d":[138499,138500,138501,138502,138503]}
			 ]
},
{"t":"a","d":[{"t":"oe","d":[138505,138506,138507]},
			  {"t":"oe","d":[138508,138509,138510]},
			  {"t":"oe","d":[138511,138512,138513]},
			  {"t":"oe","d":[138514,138515,138516]}
			 ]
},
{"t":"a","d":[{"t":"oe","d":[138493,138494,138495,138496,138497]},
			  {"t":"oe","d":[138511,138512,138513]},
			  {"t":"oe","d":[138514,138515,138516]}
			 ]
},
{"t":"a","d":[{"t":"oe","d":[138499,138500,138501,138502,138503]},
			  {"t":"oe","d":[138505,138506,138507]},
			  {"t":"oe","d":[138508,138509,138510]}
			 ]
}
],"m":"To buy Main-Conference package, please choose two day class (24-25) or a combination of the one day classes on the 24 & 25 and half-day classes on the morning and afternoon of the 24 - 25."
}
},
{"id":137515, 
"r":{"t":"o",
"d":[
{"t":"a","d":[
{"t":"oe","d":[138484,138485,138486,138487]}, 
{"t":"oe","d":[138498]}
]},
{"t":"a","d":[
{"t":"oe","d":[138484,138485,138486,138487]}, 
{"t":"oe","d":[138493,138494,138495,138496,138497]},
{"t":"oe","d":[138499,138500,138501,138502,138503]}
]},
{"t":"a","d":[
{"t":"oe","d":[138484,138485,138486,138487]}, 
{"t":"oe","d":[138493,138494,138495,138496,138497]},
{"t":"oe","d":[138511,138512,138513]},
{"t":"oe","d":[138514,138515,138516]}
]},
{"t":"a","d":[
{"t":"oe","d":[138484,138485,138486,138487]}, 
{"t":"oe","d":[138505,138506,138507]},
{"t":"oe","d":[138508,138509,138510]},
{"t":"oe","d":[138499,138500,138501,138502,138503]}
]},
{"t":"a","d":[
{"t":"oe","d":[138484,138485,138486,138487]}, 
{"t":"oe","d":[138505,138506,138507]},
{"t":"oe","d":[138508,138509,138510]},
{"t":"oe","d":[138511,138512,138513]},
{"t":"oe","d":[138514,138515,138516]}
]},
{"t":"a","d":[
{"t":"ae","d":[138491,138492]},
{"t":"oe","d":[138498]}
]},
{"t":"a","d":[
{"t":"ae","d":[138491,138492]},
{"t":"oe","d":[138493,138494,138495,138496,138497]},
{"t":"oe","d":[138499,138500,138501,138502,138503]}
]},
{"t":"a","d":[
{"t":"ae","d":[138491,138492]},
{"t":"oe","d":[138493,138494,138495,138496,138497]},
{"t":"oe","d":[138511,138512,138513]},
{"t":"oe","d":[138514,138515,138516]}
]},
{"t":"a","d":[
{"t":"ae","d":[138491,138492]}, 
{"t":"oe","d":[138505,138506,138507]},
{"t":"oe","d":[138508,138509,138510]},
{"t":"oe","d":[138499,138500,138501,138502,138503]}
]},
{"t":"a","d":[
{"t":"ae","d":[138491,138492]}, 
{"t":"oe","d":[138505,138506,138507]},
{"t":"oe","d":[138508,138509,138510]},
{"t":"oe","d":[138511,138512,138513]},
{"t":"oe","d":[138514,138515,138516]}
]}
],
"m":"To buy Full-Conference package, please choose appropriate 2 day, one day and/or half day classes."
}
},

{"id":138484, 
"r":{"t":"o",
"d":[{"t":"oe","d":[137511,137512,137515
 ]}

],"m":"To buy 'Block Party with Robyn Spady..', please choose one of the Pre/Full packages."
}
},
{"id":138485, 
"r":{"t":"o",
"d":[{"t":"oe","d":[137511,137512,137515
 ]}

],
"m":"To buy 'Beginning Sock Knitting Machine..', please choose one of the Pre/Full packages."
}
},
{"id":138486, 
"r":{"t":"oe","d":[137511,137512,137515
 ],
"m":"To buy 'Large Felt Bag with Judy Colvin..', please choose one of the Pre/Full packages."
}
},
{"id":138487, 
"r":{"t":"oe","d":[137511,137512,137515
 ],
"m":"To buy 'Beginning 4-harness Weaving..', please choose one of the Pre/Full packages."
}
},

{"id":138491, 
"r":{"t":"oe","d":[137511,137512,137515,138392],
"m":"To buy 'Beginning and Rusty Spinners..', please choose one of the Pre/Full packages or One-day Pre-conference class."
}
},
{"id":138492, 
"r":{"t":"oe","d":[137511,137512,137515,138392],
"m":"To buy 'Silk Tasting with Jane Fournier..', please choose one of the Pre/Full packages or One-day Pre-conference class."
}
},
{"id":141383, 
"r":{"t":"oe","d":[138392],
"m":"To buy 'Rigid Heddle Weaving.. June 23 class', please choose One-day Pre-conference class in additional package."
}
},
{"id":138498, 
"r":{"t":"oe","d":[137513,137514,137515],
"m":"To buy 'There are Two Sides to Every Cloth..', please choose one of the Main/Full packages."
}
},
{"id":138493, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy 'Introduction to Eco Printing..', please choose one of the Main/Full packages."
}
},
{"id":138494, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy 'Rigid Heddle Weaving..', please choose one of the Main/Full packages."
}
},
{"id":138495, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy 'Sea Urchin Pendant..', please choose one of the Main/Full packages."
}
},
{"id":138496, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy 'Leno & Beyond..', please choose one of the Main/Full packages."
}
},
{"id":138497, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy 'Pine Needle Basket..', please choose one of the Main/Full packages."
}
},

{"id":138499, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy 'Making the Most of Color', please choose one of the Main/Full packages."
}
},
{"id":138500, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy Tapestry Weaving, please choose one of the Main/Full packages."
}
},
{"id":138501, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy 'Egg Basket Oval Twined Wire Bowl..', please choose one of the Main/Full packages."
}
},
{"id":138502, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy 'Get Cracking with Crackle..', please choose one of the Main/Full packages."
}
},
{"id":138503, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy 'Fair Isle Knitting..', please choose one of the Main/Full packages."
}
},

{"id":138505, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy Half day class, please choose one of the Main/Full packages."
}
},
{"id":138506, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy Half day class, please choose one of the Main/Full packages."
}
},
{"id":138507, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy Half day class, please choose one of the Main/Full packages."
}
},
{"id":138508, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy Half day class, please choose one of the Main/Full packages"
}
},
{"id":138509, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy Half day class, please choose one of the Main/Full packages."
}
},
{"id":138510, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy Half day class, please choose one of the Main/Full packages."
}
},
{"id":138511, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy Half day class, please choose one of the Main/Full packages."
}
},
{"id":138512, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy Half day class, please choose one of the Main/Full packages."
}
},
{"id":138513, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy Half day class, please choose one of the Main/Full packages."
}
},
{"id":138514, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy Half day class, please choose one of the Main/Full packages."
}
},
{"id":138515, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy Half day class, please choose one of the Main/Full packages."
}
},
{"id":138516, 
"r":{"t":"oe","d":[137513,137514,137515, 140849,140850],
"m":"To buy Half day class, please choose one of the Main/Full packages."
}
}
];
var mutual_exclusive_rules=[
{"t":137511,"d":[137512,137513,137514,137515],"m":"You cannot buy more than one package."},
{"t":137512,"d":[137511,137513,137514,137515],"m":"You cannot buy more than one package."},
{"t":137513,"d":[137511,137512,137514,137515],"m":"You cannot buy more than one package."},
{"t":137514,"d":[137511,137512,137513,137515],"m":"You cannot buy more than one package."},
{"t":137515,"d":[137511,137512,137513,137514],"m":"You cannot buy more than one package."},
{"t":138484,"d":[138485,138486,138487,138491,138492],"m":"You cannot buy more than one class of conflicting time."},
{"t":138485,"d":[138484,138486,138487,138491,138492],"m":"You cannot buy more than one class of conflicting time."},
{"t":138486,"d":[138484,138485,138487,138491,138492],"m":"You cannot buy more than one class of conflicting time."},
{"t":138487,"d":[138484,138485,138486,138491,138492],"m":"You cannot buy more than one class of conflicting time."},
{"t":141383,"d":[138491, 138492],
	"m":"You cannot buy any class of 22 or 23 along with Ridgid Heddle Weaving.. June 23 class."},
{"t":138498,"d":[138493,138494,138495,138496,138497,138499,138500,138501,138502,138503,
138505,138506,138507,138508,138509,138510,138511,138512,138513,138514,138515,138516],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138493,"d":[138494,138495,138496,138497,138505,138506,138507,138508,138509,138510],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138494,"d":[138495,138496,138497,138505,138506,138507,138508,138509,138510],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138495,"d":[138496,138497,138505,138506,138507,138508,138509,138510],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138496,"d":[138497,138505,138506,138507,138508,138509,138510],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138497,"d":[138505,138506,138507,138508,138509,138510],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138499,"d":[138500,138501,138502,138503,138511,138512,138513,138514,138515,138516],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138500,"d":[138501,138502,138503,138511,138512,138513,138514,138515,138516],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138501,"d":[138502,138503,138511,138512,138513,138514,138515,138516],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138502,"d":[138503,138511,138512,138513,138514,138515,138516],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138503,"d":[138511,138512,138513,138514,138515,138516],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138505,"d":[138506,138507],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138506,"d":[138507],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138508,"d":[138509,138510],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138509,"d":[138510],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138511,"d":[138512,138513],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138512,"d":[138513],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138514,"d":[138515,138516],
	"m":"You cannot buy more than one class of conflicting time"},
{"t":138515,"d":[138516],
	"m":"You cannot buy more than one class of conflicting time."},
{"t":138392,"d":[137511,137512,137515],
	"m":"You cannot buy One-day Pre-conference class, if you buy pre/full package."}
	
];
<%
}
%>
function getSelectedTickets(){
	var sts=[];
	for(var t=0;t<ticketsArray.length;t++){
	var ticketd=ticketsArray[t];
	if(document.getElementById("qty_"+ticketd).type=='hidden'){
			qty=document.getElementById("qty_"+ticketd).value;
	}else{
			var x=document.getElementById("qty_"+ticketd).selectedIndex;
			qty=document.getElementById("qty_"+ticketd).options[x].value;
	}
	if(qty>0) sts.push(ticketd);
	}
	return sts;
}

function matchCustomConditionalRules(){
	
	var sts=getSelectedTickets();
	var isPassed = true;
	for(var i=0;i<sts.length;i++){
		st=sts[i];
		var trj=getTicketRule(st);
		if(trj){
			console.log("custom rule exists");
			isPassed=checkPass(trj, sts);
		}
		if(!isPassed) {
			alert(trj.m);
			break;
		}
		var trj=getTicketMutuallyExclusiveRule(st);
		if(trj){
			console.log("exclusive rule exists");
			isPassed=checkExclusivePass(trj.d, sts);
		}
		if(!isPassed) {
			alert(trj.m);
			break;
		}
	}
	console.log('validated');
	return isPassed;
}
function getTicketRule(st){
	var rule;
	for(var i=0;i<custom_conditional_rules.length;i++){
		
		if(custom_conditional_rules[i].id==st) rule=custom_conditional_rules[i].r;
	}
	return rule;
}
function getTicketMutuallyExclusiveRule(st){
	var rule;
	for(var i=0;i<mutual_exclusive_rules.length;i++){
		
		if(mutual_exclusive_rules[i].t==st) rule=mutual_exclusive_rules[i];
	}
	return rule;
}
function checkExclusivePass(d,sts){
    var mcount=0;
	for(var i=0;i<d.length;i++){
		if(checkTicketExists(d[i], sts)) mcount++;
	}
	return (mcount==0);
}
function matchAny(d,sts){
    var isAnyPass=false;
	for(var i=0;i<d.length;i++){
		isAnyPass=checkPass(d[i], sts);
		if(isAnyPass) break;
	}
	return isAnyPass;
}
function matchAll(d,sts){
    var isAllPass=false;
	for(var i=0;i<d.length;i++){
		isAllPass=checkPass(d[i], sts);
		if(!isAllPass) break;
	}
	return isAllPass;
}
function matchOneOnly(d,sts){
    var mcount=0;
	for(var i=0;i<d.length;i++){
		if(checkTicketExists(d[i], sts)) mcount++;
	}
	return (mcount==1);
}
function matchAnyTicket(d,sts){
    var isAnyPass=false;
	for(var i=0;i<d.length;i++){
		isAnyPass=checkTicketExists(d[i], sts);
		if(isAnyPass) break;
	}
	return isAnyPass;
}
function matchAllTickets(d,sts){
    var isAllPass=false;
	for(var i=0;i<d.length;i++){
		isAllPass=checkTicketExists(d[i], sts);
		if(!isAllPass) break;
	}
	return isAllPass;
}
function checkTicketExists(e,sts){
	var isExists=false;
	for(var i=0;i<sts.length;i++){
		isExists=(sts[i]==e);
		if(isExists) break;
	}
	return isExists;
}
function checkPass(rj,sts){
	var cp=false;
	console.log(rj.t);
	if (rj.t=="o"){
		cp=matchAny(rj.d, sts);
	}else if (rj.t=="a"){
		cp=matchAll(rj.d, sts);
	}else if (rj.t=="ae"){
		cp=matchAllTickets(rj.d, sts);
	}else if (rj.t=="oe"){
		cp=matchAnyTicket(rj.d, sts);
	}else if (rj.t=="xe"){
		cp=matchOneOnly(rj.d, sts);
	}
	return cp;
}